From 0eba6d463cc3a4eae03a715bcef4122ac144ede6 Mon Sep 17 00:00:00 2001
From: Anton Kikin <a.kikin@tano-systems.com>
Date: Sat, 12 May 2018 01:27:53 +0300
Subject: [PATCH] Fixed luci.sys.user.setpasswd

---
 modules/luci-base/luasrc/sys.lua | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/modules/luci-base/luasrc/sys.lua b/modules/luci-base/luasrc/sys.lua
index a972717..28570a9 100644
--- a/modules/luci-base/luasrc/sys.lua
+++ b/modules/luci-base/luasrc/sys.lua
@@ -600,8 +600,8 @@ function user.setpasswd(username, password)
 	end
 
 	return os.execute(
-		"(echo '" .. password .. "'; sleep 1; echo '" .. password .. "') | " ..
-		"passwd '" .. username .. "' >/dev/null 2>&1"
+		"(echo '" .. username .. ":" .. password .. "') | " ..
+		"chpasswd >/dev/null 2>&1"
 	)
 end
 
-- 
2.7.4

